variant: openshift
version: 4.12
systemd:
  units:
    - name: assisted-web-ui.service
      enabled: true
      contents: |
        [Unit]
        Description=Assisted Service web-ui
        Wants=network.target
        RequiresMountsFor=%t/containers
        Requires=assisted-service.service
        BindsTo=assisted-service-pod.service
        After=network-online.target assisted-service-pod.service
        ConditionPathExists=/etc/assisted-service/node0

        [Service]
        Environment=PODMAN_SYSTEMD_UNIT=%n
        Restart=on-failure
        TimeoutStartSec=500
        TimeoutStopSec=300
        ExecStartPre=/bin/rm -f %t/%n.ctr-id
        ExecStart=/usr/bin/podman run --net host --cidfile=%t/%n.ctr-id --cgroups=no-conmon --log-driver=journald --rm --pod-id-file=%t/assisted-service-pod.pod-id --sdnotify=conmon --replace -d --name=webui {{ webui_image }}
        ExecStop=/usr/bin/podman stop --ignore --cidfile=%t/%n.ctr-id
        ExecStopPost=/usr/bin/podman rm -f --ignore --cidfile=%t/%n.ctr-id
        Type=notify
        NotifyAccess=all

        [Install]
        WantedBy=multi-user.target
