# Here we put the ansible vars to override some defaults in the vm-setup
# playbooks/roles, ref https://github.com/metal3-io/metal3-dev-env

# Currently this is required because of hard-coded node-name expectations in the
# openshift-installer terraform templates
ironic_prefix: "openshift_"

# We enable more memory and masters in dev-scripts compared to the minimal setup
# in metal3-dev-env
num_masters: 3
num_workers: 1
flavors:
  master:
    memory: "{{ lookup('env', 'MASTER_MEMORY') | default('16384', true) }}"
    disk: "{{ lookup('env', 'MASTER_DISK') | default('20', true) }}"
    vcpu: "{{ lookup('env', 'MASTER_VCPU') | default('8', true) }}"
    extradisks: false

  worker:
    memory: "{{ lookup('env', 'WORKER_MEMORY') | default('8192', true) }}"
    disk: "{{ lookup('env', 'WORKER_DISK') | default('20', true) }}"
    vcpu: "{{ lookup('env', 'WORKER_VCPU') | default('4', true) }}"
    extradisks: false

# For OpenShift we create some additional DNS records for the API/DNS VIPs
baremetal_network_cidr: "{{ lookup('env', 'EXTERNAL_SUBNET') | default('192.168.111.0/24', true) }}"
dns_extrahosts:
  - ip: "{{ baremetal_network_cidr | nthhost(5) }}"
    hostnames:
      - "api"
  - ip: "{{ baremetal_network_cidr | nthhost(2) }}"
    hostnames:
      - "ns1"
  - ip: "{{ baremetal_network_cidr | nthhost(1) }}"
    hostnames:
      - "virthost"

networks:
  - name: "{{ provisioning_network_name }}"
    bridge: "{{ provisioning_network_name }}"
    forward_mode: bridge
  - name: "{{ baremetal_network_name }}"
    bridge: "{{ baremetal_network_name }}"
    forward_mode: "{{ 'bridge' if lookup('env', 'MANAGE_BR_BRIDGE') == 'n' else 'nat' }}"
    address: "{{ baremetal_network_cidr|nthhost(1) }}"
    netmask: "{{ baremetal_network_cidr|ipaddr('netmask') }}"
    dhcp_range:
      - "{{ baremetal_network_cidr|nthhost(20) }}"
      - "{{ baremetal_network_cidr|nthhost(60) }}"
    nat_port_range:
      - 1024
      - 65535
    domain: "{{ cluster_domain }}"
    dns:
      hosts: "{{dns_extrahosts | default([])}}"
      forwarders:
        - domain: "apps.{{ cluster_domain }}"
          addr: "127.0.0.1"
